{{ ansible_managed | comment }}

#
# /usr/lib/systemd/user/vncserver@.service
#
# 1. Switches for vncserver should be entered in ~/.vnc/config rather than
#    hard-coded into this unit file. See the vncserver(1) manpage.
#
# 2. Users wishing for the server to continue running after the owner logs
#    out MUST enable 'linger' with loginctl like this:
#    `loginctl enable-linger username`
#
# 3. The server can be enabled and started like this once configured:
#    `systemctl --user start eralitex@:<display>.service`
#    `systemctl --user enable eralitex@:<display>.service`

[Unit]
Description=eralitex vdesk service - display %i
After=syslog.target network.target

[Service]
Type=forking
ExecStartPre=/bin/sh -c '/usr/bin/vncserver -kill %i > /dev/null 2>&1 || :'
ExecStart=/usr/bin/fish -c "/usr/bin/vncserver -xstartup {{eralitex_directory}}/vdesk/xsession %i"
ExecStop=/usr/bin/vncserver -kill %i

[Install]
WantedBy=default.target
